<!--
Name of File: travel/templates/result.html
Brief description of the file: display results for a form submission from a travel recommendation 
Inputs: None
Outputs: creates HTML for the result page
-->
{%load static%}
{% include 'header.html' %}


<!DOCTYPE html>
<html>
<head>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Form Submission Result</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMaps" async defer></script>
    <script>
        //fuinction to intialize maps
        function initMaps() {
            //loop thorugh each result
            {% for result in results %}
                //create a new map object for the current latitude and longitude, which it gets from result.map_Data
                var map{{ forloop.counter }} = new google.maps.Map(document.getElementById('map{{ forloop.counter }}'), {
                    center: { lat: {{ result.map_data.lat }}, lng: {{ result.map_data.lng }} },
                    zoom: 12
                });

                // Add a marker for the location in the map for the current longitude and latitude
                var marker{{ forloop.counter }} = new google.maps.Marker({
                    position: { lat: {{ result.map_data.lat }}, lng: {{ result.map_data.lng }} },
                    map: map{{ forloop.counter }},
                    title: '{{ result.map_data.name }}'
                });
            {% endfor %}
        }
    </script>
</head>
<body>
    <!-- Adds a margin -->
    <div style="margin:10px">
        <!-- loop through each result -->
        {% for result in results %}
            <!--Display results-->
            <div>
                <!--Display the name of the restaurant as was given to the map to show as a title-->
                <h1 style="clear: both;">{{ result.map_data.name }}</h1>
                <!--Display the description of the restaurant from GPT-->
                <p style="clear: both;">{{ result.gpt_result }}</p>
                <!--Display the address of the location-->
                <p style="clear: both;">{{ result.map_data.address }}</p>
                <!--Display map-->
                <div id="map{{ forloop.counter }}" style="height: 400px; clear: both;"></div>

                <!--Button to link to a website to make reservations-->
                {% if result.info.website != 'N/A' %}
                <a style="margin-top: 5px; margin-bottom: 5px" href="{{ result.info.website }}" class="btn btn-primary" type="submit">Make a reservation for {{ result.map_data.name }}</a>
                {% endif %}
                <!--Display Logisitcal information: -->
                <h3 style="clear: both;">Logistical Information</h3>
                <div style="clear: both; margin-bottom: 10px;">
                    {% if result.info.rating != 'N/A' %}
                    <p>Rating: {{ result.info.rating }}</p>
                    {% endif %}
                    {% if result.info.business_status != 'N/A' %}
                    <p>Business Status: {{ result.info.business_status }}</p>
                    {% endif %}
                    {% if result.info.open_now != 'N/A' %}
                    <p>Open Status: {% if result.info.open_now %}Yes{% else %}No{% endif %}</p>
                    {% endif %}
                    {% if result.info.opening_hours != 'N/A' %}
                    <p>Opening Hours:</p>
                    <ul style="list-style-type: none; padding-left: 0;">
                        {% for day in result.info.opening_hours %}
                        <li>{{ day }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>
            <br><br>
        {% endfor %}
    </div>
</body>
</html>


{% include 'footer.html' %}